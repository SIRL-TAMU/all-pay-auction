<%= link_to seller_dashboard_path, class: "back-link" do %>
  <i class="fa-solid fa-chevron-left"></i> Back
<% end %>

<%= form_with(model: @auction_item, local: true, html: { multipart: true }, class: "auction-form") do |form| %>
  <div class="auction-container">
    <div class="create-auction-title-container">
      <div class="create-auction-title"><i class="fa-solid fa-gavel"></i> Add Auction Item</div>
    </div>

    <div class="auction-form-container">
      <!-- Left Side: General Information -->
      <div class="auction-left">
        <div class="auction-left-general"> 
          <p>General Information</p>
          <div class="input-group">
            <p>Product Name</p>
            <%= form.text_field :name, required: true, class: "input-field" %>
          </div>

          <div class="input-group">
            <p class="input-group-product">Product Description</p>
            <%= form.text_area :description, required: true, class: "input-field textarea" %>
          </div>
        </div>

        <div class="auction-left-general">
          <p>Bid Details</p>
          <div class="bid-details-grid">
            <div class="input-group">
              <p>Starting Bid</p>
              <%= form.number_field :curr_max_bid, step: 0.01, required: true, class: "input-field" %>
            </div>

            <div class="input-group">
              <p>Minimum Increment</p>
              <%= form.number_field :min_increment, step: 0.01, required: true, class: "input-field" %>
            </div>

            <div class="input-group">
              <p>Product Estimated Value</p>
              <%= form.number_field :innate_value, step: 0.01, required: true, class: "input-field" %>
            </div>
            
            <div> </div>

            <div class="input-group">
              <p>Open Date</p>
              <%= form.datetime_local_field :opening_date, required: true, class: "input-field" %>
            </div>

            <div class="input-group">
              <p>Close Date</p>
              <%= form.datetime_local_field :closing_date, required: true, class: "input-field" %>
            </div>
          </div>
        </div>
      </div>
    
      <!-- Right Side: Image Upload -->
      <div class="auction-right">
        <p>Product Images</p>

        <div class="image-container" id="image-preview-container">
          <!-- This is where previews will be shown -->
        </div>

        <!-- Multiple Image Upload Field -->
        <%= form.file_field :images, multiple: true, direct_upload: true, class: "input-field", id: "image-upload-input" %>
      </div>


    </div>
  </div>

  <!-- Submit Button -->
  <div class="form-actions">
    <%= form.submit "Create Auction Item", class: "primary-btn" %>
  </div>

<% end %>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    let imageInput = document.getElementById("image-upload-input");
    let imagePreviewContainer = document.getElementById("image-preview-container");

    if (!imageInput || !imagePreviewContainer) return;

    imageInput.addEventListener("change", function (event) {
      // Clear previous image previews
      imagePreviewContainer.innerHTML = "";

      let files = event.target.files;

      if (files.length === 0) {
        let noImagesText = document.createElement("p");
        noImagesText.textContent = "No images uploaded";
        imagePreviewContainer.appendChild(noImagesText);
      }

      for (let i = 0; i < files.length; i++) {
        let reader = new FileReader();
        reader.onload = function (e) {
          let imageWrapper = document.createElement("div");
          imageWrapper.classList.add("image-wrapper");

          let img = document.createElement("img");
          img.src = e.target.result;
          img.classList.add("product-image");

          imageWrapper.appendChild(img);
          imagePreviewContainer.appendChild(imageWrapper);
        };
        reader.readAsDataURL(files[i]);
      }
    });
  });

</script>